import{j as e,r as c,L as se,$ as ae,S as k}from"./set-USP3l9q2.js";import{C as te,u as le,N as ne,a as ie}from"./useNotifications-XBbGTYba.js";import{M as S}from"./ModalPortal-BmnFxbHG.js";import{f as T}from"./formatters-DlcN8pLi.js";import{G as ce}from"./GerenciamentoLayout-BASI72Rp.js";import"./index-C30vnlgS.js";function de({cliente:s,fechar:t}){var n,i;return s?e.jsxs(S,{children:[e.jsx("div",{className:"modal-backdrop fade show",onClick:t}),e.jsx("div",{className:"modal fade show",style:{display:"block"},tabIndex:-1,children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-eye me-2"}),"Detalhes do Cliente"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:t,"aria-label":"Fechar modal"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("dl",{className:"row cliente-detalhes-list mb-0",children:[e.jsx("dt",{className:"col-sm-4 cliente-detalhes-label",children:"Nome"}),e.jsx("dd",{className:"col-sm-8 cliente-detalhes-text cliente-detalhes-value text-break",children:s.nome}),e.jsx("dt",{className:"col-sm-4 cliente-detalhes-label",children:"E-mail"}),e.jsx("dd",{className:"col-sm-8 cliente-detalhes-text cliente-detalhes-value text-break",children:s.email}),e.jsx("dt",{className:"col-sm-4 cliente-detalhes-label",children:"Telefone"}),e.jsx("dd",{className:"col-sm-8 cliente-detalhes-text cliente-detalhes-value text-break",children:(()=>{const a=s.telefone_formatado||s.telefone;return a?T(a):"NÃ£o informado"})()}),e.jsx("dt",{className:"col-sm-4 cliente-detalhes-label",children:"Saldo"}),e.jsx("dd",{className:"col-sm-8 cliente-detalhes-text cliente-detalhes-value text-break",children:((n=s.conta_fiada)==null?void 0:n.saldo_formatado)||""}),e.jsx("dt",{className:"col-sm-4 cliente-detalhes-label",children:"DescriÃ§Ã£o"}),e.jsx("dd",{className:"col-sm-8 cliente-detalhes-text cliente-detalhes-value cliente-detalhes-descricao text-break",children:((i=s.conta_fiada)==null?void 0:i.descricao)||""}),e.jsx("dt",{className:"col-sm-4 cliente-detalhes-label",children:"Cadastrado em"}),e.jsx("dd",{className:"col-sm-8 cliente-detalhes-text cliente-detalhes-value",children:new Date(s.created_at).toLocaleDateString("pt-BR")})]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:t,children:"Fechar"})})]})})})]}):null}function re({show:s,cliente:t,onClose:n,onSuccess:i}){return s?e.jsxs(S,{children:[e.jsx("div",{className:"modal-backdrop fade show",onClick:n}),e.jsx("div",{className:"modal fade show",style:{display:"block"},tabIndex:-1,children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-pencil-square me-2"}),"Editar Cliente"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:n,"aria-label":"Fechar modal"})]}),e.jsx(te,{modo:"edit",cliente:t,onClose:n,onSuccess:i})]})})})]}):null}function oe(s){const t=a=>typeof window>"u"?!1:window.matchMedia(a).matches,[n,i]=c.useState(()=>t(s));return c.useEffect(()=>{const a=window.matchMedia(s),o=d=>{i(d.matches)};i(a.matches);try{a.addEventListener("change",o)}catch{a.addListener(o)}return()=>{try{a.removeEventListener("change",o)}catch{a.removeListener(o)}}},[s]),n}const Q=s=>{if(!s||s.saldo===0)return e.jsx("span",{className:"badge text-bg-secondary fw-normal",style:{fontSize:"0.9rem"},children:"â€”"});const{saldo:t,saldo_formatado:n}=s,i=t>0?"text-bg-danger":"text-bg-success";return e.jsx("span",{className:`badge ${i} fs-6`,children:n})},G=(s=!1)=>{const t=e.jsxs("div",{className:"text-center text-muted p-5",children:[e.jsx("i",{className:"bi bi-people display-4 d-block mb-3"}),e.jsx("h5",{children:"Nenhum cliente encontrado"})]});return s?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"estado-vazio",style:{padding:0},children:t})}):t},H=s=>{const t=s.telefone_formatado||s.telefone;return t?T(t):"NÃ£o informado"},me=({clientes:s,abrirDetalhes:t,abrirConfirmarPagamento:n,abrirModal:i})=>e.jsx("div",{className:"clientes-table-container table-responsive scroll-shadow fade-in",children:e.jsxs("table",{className:"table-hover data-table clientes-table mb-0 table align-middle",children:[e.jsx("thead",{className:"clientes-table-header",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Contato"}),e.jsx("th",{children:"Conta Fiada"}),e.jsx("th",{children:"Cadastrado em"}),e.jsx("th",{className:"actions-column",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:s.length===0?G(!0):s.map(a=>e.jsxs("tr",{className:"cliente-row",children:[e.jsx("td",{"data-label":"Cliente",children:e.jsx("div",{className:"cliente-info",children:e.jsx("strong",{className:"cliente-nome",children:a.nome})})}),e.jsx("td",{"data-label":"Contato",children:e.jsxs("div",{className:"cliente-contato",children:[e.jsx("div",{className:"cliente-email",children:a.email}),e.jsx("small",{className:"cliente-telefone",children:H(a)})]})}),e.jsx("td",{"data-label":"Conta Fiada",children:Q(a.conta_fiada)}),e.jsx("td",{"data-label":"Cadastrado",children:e.jsx("small",{className:"data-cadastro",children:new Date(a.created_at).toLocaleDateString("pt-BR")})}),e.jsx("td",{"data-label":"AÃ§Ãµes",children:e.jsxs("div",{className:"cliente-actions",children:[e.jsx("button",{className:"btn-action btn-view",title:"Ver detalhes",onClick:()=>t(a),children:e.jsx("i",{className:"bi bi-eye"})}),e.jsx("button",{className:"btn-action btn-wallet",title:"Conta fiada",onClick:()=>n(a),children:e.jsx("i",{className:"bi bi-wallet2"})}),e.jsx("button",{onClick:()=>i("edit",a),className:"btn-action btn-edit",title:"Editar cliente",children:e.jsx("i",{className:"bi bi-pencil"})})]})})]},a.id))})]})}),he=({clientes:s,abrirDetalhes:t,abrirConfirmarPagamento:n,abrirModal:i})=>e.jsx("div",{className:"fade-in p-2",children:s.length===0?G(!1):s.map(a=>e.jsx("div",{className:"card mb-2 shadow-sm",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("div",{style:{flex:1,minWidth:0},children:e.jsx("h5",{className:"card-title mb-1 text-break",children:a.nome})}),e.jsx("div",{className:"ps-2",children:Q(a.conta_fiada)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"small text-muted text-truncate",title:a.email,children:[e.jsx("i",{className:"bi bi-envelope me-2",style:{width:"1.2rem"}}),a.email||"Sem email"]}),e.jsxs("div",{className:"small text-muted",children:[e.jsx("i",{className:"bi bi-telephone me-2",style:{width:"1.2rem"}}),H(a)]}),e.jsxs("div",{className:"small text-muted mt-1",children:[e.jsx("i",{className:"bi bi-calendar-event me-2",style:{width:"1.2rem"}}),"Cadastrado em: ",new Date(a.created_at).toLocaleDateString("pt-BR")]})]}),e.jsxs("div",{className:"btn-group w-100",role:"group",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary",title:"Ver detalhes",onClick:()=>t(a),children:e.jsx("i",{className:"bi bi-eye"})}),e.jsx("button",{type:"button",className:"btn btn-outline-success",title:"Conta fiada",onClick:()=>n(a),children:e.jsx("i",{className:"bi bi-wallet2"})}),e.jsx("button",{type:"button",className:"btn btn-outline-warning",title:"Editar cliente",onClick:()=>i("edit",a),children:e.jsx("i",{className:"bi bi-pencil"})})]})]})},a.id))});function xe(s){return oe("(min-width: 768px)")?e.jsx(me,{...s}):e.jsx(he,{...s})}function je({cliente:s,fechar:t,confirmar:n}){return s?e.jsxs(S,{children:[e.jsx("div",{className:"modal-backdrop fade show",onClick:t}),e.jsx("div",{className:"modal fade show",style:{display:"block"},tabIndex:-1,children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsx("div",{className:"modal-content p-4 text-center",children:e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem",animation:"spin 1.2s linear infinite"},children:e.jsx("i",{className:"bi bi-wallet2 text-warning wallet-animated"})}),e.jsx("h5",{className:"mb-3",children:"Tem certeza que deseja pagar (deletar) a conta fiada deste cliente?"}),e.jsxs("p",{className:"mb-4",children:["Esta aÃ§Ã£o Ã© ",e.jsx("strong",{children:"irreversÃ­vel"}),"! O saldo da conta fiada serÃ¡ zerado e o histÃ³rico removido."]}),e.jsxs("div",{className:"d-flex justify-content-center gap-3",children:[e.jsx("button",{className:"btn btn-secondary",onClick:t,children:"Cancelar"}),e.jsxs("button",{className:"btn btn-danger",onClick:n,children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Sim, pagar conta fiada"]})]})]})})})}),e.jsx("style",{children:`
          @keyframes spin {
            0% { transform: rotate(-10deg);}
            50% { transform: rotate(10deg);}
            100% { transform: rotate(-10deg);}
          }
        `})]}):null}function ue(s){const t=a=>typeof window>"u"?!1:window.matchMedia(a).matches,[n,i]=c.useState(()=>t(s));return c.useEffect(()=>{const a=window.matchMedia(s),o=d=>{i(d.matches)};i(a.matches);try{a.addEventListener("change",o)}catch{a.addListener(o)}return()=>{try{a.removeEventListener("change",o)}catch{a.removeListener(o)}}},[s]),n}const f=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),O=s=>new Date(s).toLocaleString("pt-BR"),W=s=>{const t=s==="pendente",n=t?"text-bg-warning":"text-bg-success",i=t?"Pendente":"Pago";return e.jsx("span",{className:`badge ${n}`,children:i})},be=({vendas:s})=>e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover table-sm table-bordered mb-0 align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:s.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-break",children:e.jsx("strong",{children:t.cliente})}),e.jsx("td",{className:"text-success text-nowrap",children:e.jsx("strong",{children:f(t.valor)})}),e.jsx("td",{className:"text-nowrap",children:O(t.data)}),e.jsx("td",{children:W(t.status)})]},t.id))})]})}),fe=({vendas:s})=>e.jsx(e.Fragment,{children:s.map(t=>e.jsx("div",{className:"card mb-2 shadow-sm",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsx("div",{className:"fw-bold text-break pe-2",children:t.cliente}),W(t.status)]}),e.jsx("div",{className:"text-success fw-bold fs-5 mb-1",children:f(t.valor)}),e.jsx("div",{className:"text-muted small",children:O(t.data)})]})},t.id))});function Ne({className:s="",initialData:t=[]}){const[n,i]=c.useState(!1),[a,o]=c.useState(!1),[d,x]=c.useState(t),N=ue("(min-width: 768px)");c.useEffect(()=>{x(t||[])},[t]),c.useEffect(()=>{if(!n||d.length>0)return;let r=!1;return(async()=>{try{o(!0);const h=await fetch("/gerenciamento/fiado/historico",{headers:{Accept:"application/json"},credentials:"same-origin"});if(!h.ok)throw new Error("Falha ao carregar histÃ³rico");const g=await h.json();r||x(g.vendas_fiadas||[])}catch{r||x([])}finally{r||o(!1)}})(),()=>{r=!0}},[n,d.length]);const u=d.filter(r=>r.status==="pendente"),p=d.filter(r=>r.status==="pago"),v=u.reduce((r,h)=>r+(h.valor||0),0),M=p.reduce((r,h)=>r+(h.valor||0),0);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:`btn-historico-fiada ${s}`,onClick:()=>i(!0),title:"Ver histÃ³rico de contas fiadas",children:[e.jsx("i",{className:"bi bi-wallet2"}),"HistÃ³rico Fiadas",e.jsx("span",{className:"badge-total",children:f(v)})]}),n&&e.jsxs(S,{children:[e.jsx("div",{className:"modal-backdrop fade show",onClick:()=>i(!1)}),e.jsx("div",{className:"modal fade show",style:{display:"block"},tabIndex:-1,children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-wallet2 me-2"}),"HistÃ³rico de Contas Fiadas"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>i(!1)})]}),e.jsxs("div",{className:"modal-body",children:[a&&e.jsxs("div",{className:"d-flex align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"spinner-border me-2",role:"status"}),"Carregandoâ€¦"]}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6 mb-2 mb-md-0",children:e.jsx("div",{className:"card border-warning h-100",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsxs("h6",{className:"card-title text-warning",children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Pendentes"]}),e.jsx("h4",{className:"text-warning mb-0",children:f(v)}),e.jsxs("small",{className:"text-muted",children:[u.length," vendas"]})]})})}),e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"card border-success h-100",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsxs("h6",{className:"card-title text-success",children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Pagas"]}),e.jsx("h4",{className:"text-success mb-0",children:f(M)}),e.jsxs("small",{className:"text-muted",children:[p.length," vendas"]})]})})})]}),d.length===0?e.jsx("div",{className:"text-muted py-4 text-center",children:"Nenhuma venda fiada encontrada"}):N?e.jsx(be,{vendas:d}):e.jsx(fe,{vendas:d})]})]})]})})})]})]})}function ke({clientes:s=[],error:t,fiadoHistorico:n=[]}){const i=c.useRef(null),[a,o]=c.useState(""),[d,x]=c.useState(""),[N,u]=c.useState(!1),{notifications:p,addNotification:v,removeNotification:M}=le(),[r,h]=c.useState(!1),[g,q]=c.useState("create"),[F,_]=c.useState(null),[L,D]=c.useState(!1),[P,R]=c.useState(null),[E,B]=c.useState(!1),[w,A]=c.useState(null);c.useEffect(()=>{var l;(l=i.current)==null||l.focus()},[]);const C=Array.isArray(s)?s:[],I=C.filter(l=>{const m=l.nome.toLowerCase().includes(a.toLowerCase())||l.email.toLowerCase().includes(a.toLowerCase());let j=!0;return d&&(d==="pendente"?j=l.conta_fiada&&l.conta_fiada.saldo>0:d==="quitada"&&(j=!l.conta_fiada||l.conta_fiada.saldo<=0)),m&&j}),J=()=>{u(!0),k.get("/gerenciamento/clientes",{},{onFinish:()=>u(!1)})},K=()=>{o(""),x("")},U=(l,m)=>{q(l),h(!0),_((m==null?void 0:m.id)??null)},b=()=>{h(!1),_(null)},X=l=>{R(l),D(!0)},V=()=>{D(!1),R(null)},Y=l=>{A(l),B(!0)},y=()=>{B(!1),A(null)},Z=()=>{w&&k.delete(`/gerenciamento/clientes/${w.id}/conta-fiada`,{preserveScroll:!0,onSuccess:y,onError:y})};c.useEffect(()=>{const l=m=>{m.key==="Escape"&&(L?V():r?b():E&&y())};return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[r,L,E]);const ee=l=>{var m,j,$,z;if(l)return{...l,conta_fiada:{saldo:((m=l.conta_fiada)==null?void 0:m.saldo)??0,saldo_formatado:((j=l.conta_fiada)==null?void 0:j.saldo_formatado)??"R$ 0,00",descricao:(($=l.conta_fiada)==null?void 0:$.descricao)??"",status:((z=l.conta_fiada)==null?void 0:z.status)??""}}};return e.jsxs(ce,{title:"Clientes",children:[e.jsx(se,{title:"Clientes"}),e.jsx(ne,{notifications:p,onRemove:M}),e.jsxs("div",{className:"clientes-header elemento-clientes-1",children:[e.jsxs("div",{className:"clientes-header-content elemento-clientes-2",children:[e.jsxs("div",{className:"clientes-title-section elemento-clientes-3",children:[e.jsx("h1",{className:"clientes-title",children:"GestÃ£o de Clientes"}),e.jsx("p",{className:"clientes-subtitle",children:"Gerencie seus clientes e contas fiadas"})]}),e.jsxs("div",{className:"clientes-actions elemento-clientes-4",children:[e.jsxs("button",{className:"btn-refresh",onClick:J,disabled:N,children:[N?e.jsx("span",{className:"spinner-loading"}):e.jsx("i",{className:"bi bi-arrow-clockwise"}),"Atualizar"]}),e.jsx(Ne,{initialData:n})]})]}),e.jsxs("div",{className:"clientes-filtros-responsive",children:[e.jsxs("div",{className:"search-input-group-responsive",children:[e.jsx("i",{className:"bi bi-search search-icon"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Buscar por nome ou e-mail...",value:a,onChange:l=>o(l.target.value),maxLength:100,"aria-label":"Buscar clientes"})]}),e.jsxs("div",{className:"clientes-filtros-row",children:[e.jsxs("select",{className:"form-select",style:{width:"200px",flexShrink:0},value:d,onChange:l=>x(l.target.value),children:[e.jsx("option",{value:"",children:"Todas as contas"}),e.jsx("option",{value:"pendente",children:"ðŸ“‹ Conta Pendente"}),e.jsx("option",{value:"quitada",children:"âœ… Conta Quitada"})]}),e.jsx("button",{className:"btn btn-outline-secondary flex-shrink-0",onClick:K,title:"Limpar filtros",children:e.jsx("i",{className:"bi bi-arrow-clockwise"})})]})]}),e.jsxs("div",{className:"clientes-counter",children:[I.length," de ",C.length," clientes",(a||d)&&e.jsx("small",{className:"text-muted ms-2",children:"(filtros aplicados)"})]})]}),C.length===0?e.jsxs("div",{className:"clientes-empty-state elemento-clientes-6",children:[e.jsx("i",{className:"bi bi-people clientes-empty-icon"}),e.jsx("h3",{children:"Cadastre um cliente durante uma venda"}),e.jsx("p",{children:"Abra sua Aba de vendas e crie o cliente no metodo Conta Fiada."}),e.jsxs(ae,{href:"/gerenciamento/vendas",className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-cash-register"})," Ir para Vendas"]})]}):e.jsx("div",{className:"elemento-clientes-5",children:e.jsx(xe,{clientes:I,abrirDetalhes:X,abrirConfirmarPagamento:Y,abrirModal:U})}),g==="create"&&r&&e.jsx(ie,{show:r,onClose:b,onSuccess:()=>{b(),k.get("/gerenciamento/clientes")}}),g==="edit"&&r&&F!==null&&e.jsx(re,{show:r,cliente:ee(C.find(l=>l.id===F)),onClose:b,onSuccess:()=>{b(),v({type:"success",title:"Cliente",message:"Cliente atualizado com sucesso!"}),k.get("/gerenciamento/clientes")}}),L&&P&&e.jsx(de,{cliente:P,fechar:V}),E&&w&&e.jsx(je,{cliente:w,fechar:y,confirmar:Z})]})}export{ke as default};
