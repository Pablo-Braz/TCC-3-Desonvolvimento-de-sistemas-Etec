import{L as o}from"./loader-system-9B1aX_n9.js";import{V as r}from"./validation-system-CX9NfGVc.js";class d{constructor(){this.elements={},this.countdownInterval=null,this.manualCheckInterval=null,this.manualDetectionTimeout=null,this.remainingSeconds=0,this.isBlocked=!1,this.lastPunish=0,this.handleManualEnable=this.handleManualEnable.bind(this),this.checkManualChanges=this.checkManualChanges.bind(this),this.init()}init(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.start()):this.start()}start(){if(this.findElements(),!this.elements.loginForm)return;const e=this.checkPersistedState();!e&&this.elements.alert&&this.isAlertVisible()?this.processServerAlert():e||this.enableForm()}findElements(){this.elements={alert:document.getElementById("rateLimitAlert"),countdown:document.getElementById("countdown"),progressFill:document.getElementById("progressFill"),loginForm:document.getElementById("loginForm"),loginButton:document.querySelector(".form-login-button")||document.getElementById("loginButton"),emailInput:document.getElementById("EMAIL"),senhaInput:document.getElementById("SENHA_HASH")}}isAlertVisible(){const e=this.elements.alert;if(!e)return!1;const t=window.getComputedStyle(e);return t.display!=="none"&&t.visibility!=="hidden"&&e.offsetHeight>0}checkPersistedState(){try{const e=localStorage.getItem("rateLimitState");if(e){const t=JSON.parse(e),n=Date.now();if(t.blockedUntil&&n<t.blockedUntil)return this.remainingSeconds=Math.ceil((t.blockedUntil-n)/1e3),this.createOrShowAlert(this.remainingSeconds),this.startCountdown(this.remainingSeconds),!0;localStorage.removeItem("rateLimitState")}}catch{}return!1}createOrShowAlert(e=60){if(this.elements.alert&&this.isAlertVisible()){this.showAlert();return}this.elements.alert?this.showAlert():(this.createAlertElement(e),setTimeout(()=>this.findElements(),50))}createAlertElement(e=60){var n;const t=document.querySelector(".form-login-body")||document.querySelector(".form-login-container")||((n=document.querySelector("#loginForm"))==null?void 0:n.parentElement);t&&(t.insertAdjacentHTML("afterbegin",`
            <div class="rate-limit-alert" id="rateLimitAlert">
                <div class="rate-limit-content">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                    <div>
                        <strong>ðŸš¨ Muitas tentativas de login!</strong>
                        <p>Aguarde <span id="countdown">${e}</span> segundos para tentar novamente.</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>
                </div>
            </div>
        `),this.elements.alert=document.getElementById("rateLimitAlert"),this.elements.countdown=document.getElementById("countdown"),this.elements.progressFill=document.getElementById("progressFill"))}showAlert(){this.elements.alert&&(this.elements.alert.style.display="block")}hideAlert(){this.elements.alert&&(this.elements.alert.style.display="none")}processServerAlert(){if(!this.elements.alert)return;const t=(this.elements.alert.textContent||this.elements.alert.innerText).match(/(\d+)\s+segundos/);t&&(this.remainingSeconds=parseInt(t[1]),this.startCountdown(this.remainingSeconds))}startCountdown(e){this.remainingSeconds=e,this.disableForm(),this.saveState(this.remainingSeconds),this.updateDisplay(this.remainingSeconds,e),this.countdownInterval&&clearInterval(this.countdownInterval),this.manualCheckInterval&&clearInterval(this.manualCheckInterval),this.countdownInterval=setInterval(()=>{this.remainingSeconds>1?(this.remainingSeconds--,this.updateDisplay(this.remainingSeconds,e),this.saveState(this.remainingSeconds)):this.finishCountdown()},1e3),this.manualCheckInterval=setInterval(this.checkManualChanges,500)}updateDisplay(e,t=60){if(this.elements.countdown||this.findElements(),this.elements.countdown&&(this.elements.countdown.textContent=e),this.elements.progressFill){const n=(t-e)/t*100;this.elements.progressFill.style.width=n+"%"}}disableForm(){[this.elements.emailInput,this.elements.senhaInput,this.elements.loginButton].forEach(t=>{t&&(t.disabled=!0,t.addEventListener("focus",this.handleManualEnable),t.addEventListener("input",this.handleManualEnable),t.addEventListener("click",this.handleManualEnable))}),this.elements.loginButton&&(this.elements.loginButton.textContent="Aguarde..."),this.createOrShowAlert(this.remainingSeconds)}enableForm(){[this.elements.emailInput,this.elements.senhaInput,this.elements.loginButton].forEach(t=>{t&&(t.disabled=!1,t.removeEventListener("focus",this.handleManualEnable),t.removeEventListener("input",this.handleManualEnable),t.removeEventListener("click",this.handleManualEnable))}),this.elements.loginButton&&(this.elements.loginButton.textContent="Entrar"),this.hideAlert(),this.elements.progressFill&&(this.elements.progressFill.style.width="0%"),this.countdownInterval&&clearInterval(this.countdownInterval),this.manualCheckInterval&&clearInterval(this.manualCheckInterval)}finishCountdown(){clearInterval(this.countdownInterval),clearInterval(this.manualCheckInterval),localStorage.removeItem("rateLimitState"),this.enableForm()}saveState(e){try{localStorage.setItem("rateLimitState",JSON.stringify({blockedUntil:Date.now()+e*1e3,seconds:e,timestamp:Date.now()}))}catch{}}checkManualChanges(){const e=[this.elements.emailInput,this.elements.senhaInput,this.elements.loginButton];e.some(t=>t&&!t.disabled)&&(this.handleManualEnable(),e.forEach(t=>{t&&(t.disabled=!0)}),this.elements.loginButton&&(this.elements.loginButton.textContent="Aguarde..."))}handleManualEnable(){const e=Date.now();(!this.lastPunish||e-this.lastPunish>1e3)&&(this.remainingSeconds+=10,this.saveState(this.remainingSeconds),this.updateDisplay(this.remainingSeconds,this.remainingSeconds),this.lastPunish=e)}forceReset(){clearInterval(this.countdownInterval),clearInterval(this.manualCheckInterval),localStorage.removeItem("rateLimitState"),this.enableForm()}}if(document.getElementById("loginForm")||document.querySelector(".form-login")){const i=new d;window.loginRateLimiter=i,document.addEventListener("keydown",function(e){e.ctrlKey&&e.shiftKey&&e.key==="L"&&i.forceReset()})}class l{constructor(){this.loader=null,this.validation=null,this.init()}init(){document.addEventListener("DOMContentLoaded",()=>{this.setupSystems()})}setupSystems(){this.loader=new o("loginForm","loader-cadastro"),this.validation=new r,this.validation.addValidation("EMAIL","email"),this.validation.addValidation("SENHA_HASH","password"),console.log("âœ… Sistema de login inicializado")}}function h(i,e){const t=document.getElementById(i),n=document.getElementById(e);t&&n&&t.addEventListener("click",()=>{const a=n.type==="password";n.type=a?"text":"password";const s=t.querySelector("i");s&&(s.classList.toggle("bi-eye"),s.classList.toggle("bi-eye-slash"))})}(document.getElementById("loginForm")||document.querySelector(".form-login"))&&(new l,document.getElementById("toggleSenha")&&document.getElementById("SENHA_HASH")&&h("toggleSenha","SENHA_HASH"),window.LoginSystem=l);
