import{r as N,m as q,j as e}from"./set-Dr3sRFX0.js";import{M as $}from"./ModalPortal-DqnXe3eG.js";import{f as S}from"./formatters-DlcN8pLi.js";const w=(a=[])=>!a||a.length===0?"Produtos da compra: venda sem itens":`Produtos da compra: ${a.map(o=>{const m=(o.quantidade*o.preco_unitario).toFixed(2).replace(".",",");return`${o.produto.nome} (${o.quantidade}x) = R$ ${m}`}).join(", ")}`;function A({cliente:a,modo:s,onClose:o,onSuccess:m,carrinhoItens:f=[],embed:x=!1}){var C;const i=N.useMemo(()=>w(f),[f]),{data:t,setData:r,processing:u,errors:n,reset:v}=q({nome:(a==null?void 0:a.nome)||"",email:(a==null?void 0:a.email)||"",telefone:(a==null?void 0:a.telefone_formatado)||(a==null?void 0:a.telefone)||"",descricao:s==="create"?i:((C=a==null?void 0:a.conta_fiada)==null?void 0:C.descricao)||""}),[h,p]=N.useState(!1);N.useEffect(()=>{var l;s==="edit"&&a?r({nome:a.nome,email:a.email,telefone:a.telefone_formatado||a.telefone||"",descricao:((l=a.conta_fiada)==null?void 0:l.descricao)||""}):s==="create"&&r({nome:"",email:"",telefone:"",descricao:i})},[a,s,i]),N.useEffect(()=>{s==="create"&&r("descricao",i)},[i,s]);const F=l=>{var b,g;if(l.preventDefault(),p(!0),s==="create"){const j=t.descricao&&t.descricao.trim()!==""?t.descricao:i,c={nome:t.nome,email:t.email,telefone:t.telefone,descricao:j};fetch("/gerenciamento/clientes",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":((b=document.querySelector('meta[name="csrf-token"]'))==null?void 0:b.getAttribute("content"))||""},body:JSON.stringify(c)}).then(d=>d.ok?d.json():d.json().then(y=>{y.errors&&Object.keys(y.errors).forEach(E=>{n[E]=y.errors[E][0]}),p(!1)})).then(d=>{d&&d.success&&d.cliente&&(v(),m(d.cliente))}).catch(d=>{console.error("Erro na requisição:",d),alert("Erro ao criar cliente. Tente novamente.")}).finally(()=>p(!1))}else{const j={nome:t.nome,email:t.email,telefone:t.telefone};fetch(`/gerenciamento/clientes/${a==null?void 0:a.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":((g=document.querySelector('meta[name="csrf-token"]'))==null?void 0:g.getAttribute("content"))||""},body:JSON.stringify(j)}).then(c=>c.json()).then(c=>{c.success?(v(),m(c.cliente)):(console.error("Erro na edição:",c),alert(c.message||"Erro ao editar cliente"))}).catch(c=>{console.error("Erro na requisição de edição:",c),alert("Erro ao editar cliente. Tente novamente.")}).finally(()=>p(!1))}},T=l=>{const b=l.target.value;if(b.replace(/\D/g,"").length>11)return;const j=S(b);r("telefone",j)};return e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{htmlFor:"nome",className:"form-label",children:"Nome *"}),e.jsx("input",{id:"nome",type:"text",className:`form-control ${n.nome?"is-invalid":""}`,value:t.nome,onChange:l=>r("nome",l.target.value),required:!0,autoFocus:!0,disabled:u||h}),n.nome&&e.jsx("div",{className:"invalid-feedback",children:n.nome})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"E-mail *"}),e.jsx("input",{id:"email",type:"email",className:`form-control ${n.email?"is-invalid":""}`,value:t.email,onChange:l=>r("email",l.target.value),required:!0,disabled:u||h}),n.email&&e.jsx("div",{className:"invalid-feedback",children:n.email})]})]}),e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{htmlFor:"telefone",className:"form-label",children:"Telefone"}),e.jsx("input",{id:"telefone",type:"text",className:`form-control ${n.telefone?"is-invalid":""}`,value:t.telefone,onChange:T,placeholder:"(11) 99999-9999",maxLength:15,disabled:u||h}),n.telefone&&e.jsx("div",{className:"cliente-form-error",children:n.telefone})]})}),s==="create"&&e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12 mb-3",children:[e.jsxs("label",{htmlFor:"descricao",className:"form-label",children:["Descrição da Conta ",e.jsx("span",{className:"text-muted",children:"(opcional)"})]}),e.jsx("textarea",{className:"form-control",id:"descricao",rows:3,value:t.descricao,onChange:l=>r("descricao",l.target.value),placeholder:"Gerado automaticamente com base nos produtos do carrinho (você pode editar)",maxLength:500,disabled:u||h}),e.jsx("div",{className:"form-text",children:e.jsx("small",{className:"text-muted",children:"Esta descrição foi gerada automaticamente com base nos produtos do carrinho."})}),n.descricao&&e.jsx("div",{className:"invalid-feedback d-block",children:n.descricao})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{v(),o()},disabled:u||h,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:u||h,children:u||h?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),s==="create"?"Criando...":"Atualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-lg me-2"}),s==="create"?"Salvar Cliente":"Salvar Alterações"]})})]})]})}function P({show:a,onClose:s,onSuccess:o,carrinhoItens:m=[]}){return a?e.jsxs($,{children:[e.jsx("div",{className:"modal-backdrop fade show",onClick:s}),e.jsx("div",{className:"modal fade show",style:{display:"block"},tabIndex:-1,children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-person-plus me-2"}),"Cadastrar Cliente"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:s,"aria-label":"Fechar modal"})]}),e.jsx(A,{modo:"create",onClose:s,onSuccess:o,carrinhoItens:m})]})})})]}):null}const X=({notifications:a,onRemove:s})=>a.length===0?null:e.jsx("div",{className:"position-fixed top-0 end-0 p-3",style:{zIndex:9999},children:a.map(o=>e.jsx("div",{className:`alert notification-modern alert-${o.type} notification-enter mb-2`,role:"alert",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsxs("div",{className:"flex-grow-1",children:[o.title&&e.jsx("div",{className:"fw-bold mb-1",children:o.title}),e.jsx("div",{className:"small",children:o.message})]}),o.count&&o.count>1&&e.jsxs("span",{className:"badge rounded-pill text-bg-secondary ms-2",title:"Agrupadas",children:["x",o.count]}),e.jsx("button",{type:"button",className:"btn-close ms-2","aria-label":"Fechar",onClick:()=>s(o.id)})]})},o.id))}),k=3,L=()=>{const[a,s]=N.useState([]),o=f=>{const x=`${Date.now()}-${Math.random()}`,i={...f,id:x};s(t=>{const r=[...t,i];return r.length>k?r.slice(r.length-k):r}),setTimeout(()=>{m(x)},f.duration||5e3)},m=f=>{s(x=>x.filter(i=>i.id!==f))};return{notifications:a,addNotification:o,removeNotification:m}};export{A as C,X as N,P as a,L as u};
