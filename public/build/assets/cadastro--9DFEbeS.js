import{C as l}from"./cnpj-formatter-DBfm7InR.js";import{L as d}from"./loader-system-9B1aX_n9.js";import{V as m}from"./validation-system-CX9NfGVc.js";class c{constructor(){this.elements={},this.countdownInterval=null,this.manualCheckInterval=null,this.remainingSeconds=0,this.lastPunish=0,this.handleManualEnable=this.handleManualEnable.bind(this),this.checkManualChanges=this.checkManualChanges.bind(this),this.init()}init(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.start()):this.start()}start(){this.findElements();const e=this.checkPersistedState();!e&&this.elements.alert&&this.isAlertVisible()?this.processServerAlert():e||this.enableForm()}findElements(){this.elements={alert:document.getElementById("rateLimitAlert"),countdown:document.getElementById("countdown"),progressFill:document.getElementById("progressFill"),cadastroForm:document.getElementById("cadastroForm"),cadastroButton:document.querySelector(".form-cadastro-button"),nomeInput:document.getElementById("NOME"),emailInput:document.getElementById("EMAIL"),senhaInput:document.getElementById("SENHA_HASH"),confirmarSenhaInput:document.getElementById("SENHA_HASH_confirmation"),perfilInput:document.getElementById("PERFIL"),comercioNomeInput:document.getElementById("COMERCIO_NOME"),comercioCnpjInput:document.getElementById("COMERCIO_CNPJ")}}isAlertVisible(){const e=this.elements.alert;if(!e)return!1;const t=window.getComputedStyle(e);return t.display!=="none"&&t.visibility!=="hidden"&&e.offsetHeight>0}checkPersistedState(){try{const e=localStorage.getItem("cadastroRateLimitState");if(e){const t=JSON.parse(e),n=Date.now();if(t.blockedUntil&&n<t.blockedUntil)return this.remainingSeconds=Math.ceil((t.blockedUntil-n)/1e3),this.createOrShowAlert(this.remainingSeconds),this.startCountdown(this.remainingSeconds),!0;localStorage.removeItem("cadastroRateLimitState")}}catch{}return!1}createOrShowAlert(e=60){if(this.elements.alert&&this.isAlertVisible()){this.showAlert();return}this.elements.alert?this.showAlert():(this.createAlertElement(e),setTimeout(()=>this.findElements(),50))}createAlertElement(e=60){var n;const t=document.querySelector(".form-cadastro-body")||document.querySelector(".form-cadastro-container")||((n=document.querySelector("#cadastroForm"))==null?void 0:n.parentElement);t&&(t.insertAdjacentHTML("afterbegin",`
            <div class="rate-limit-alert" id="rateLimitAlert">
                <div class="rate-limit-content">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                    <div>
                        <strong>ðŸš¨ Cadastro bloqueado!</strong>
                        <p>Aguarde <span id="countdown">${e}</span> segundos para tentar novamente.</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>
                </div>
            </div>
        `),this.elements.alert=document.getElementById("rateLimitAlert"),this.elements.countdown=document.getElementById("countdown"),this.elements.progressFill=document.getElementById("progressFill"))}showAlert(){this.elements.alert&&(this.elements.alert.style.display="block")}hideAlert(){this.elements.alert&&(this.elements.alert.style.display="none")}processServerAlert(){if(!this.elements.alert)return;const t=(this.elements.alert.textContent||this.elements.alert.innerText).match(/(\d+)\s+segundos/);t&&(this.remainingSeconds=parseInt(t[1]),this.startCountdown(this.remainingSeconds))}startCountdown(e){this.remainingSeconds=e,this.disableForm(),this.saveState(this.remainingSeconds),this.updateDisplay(this.remainingSeconds,e),this.countdownInterval&&clearInterval(this.countdownInterval),this.manualCheckInterval&&clearInterval(this.manualCheckInterval),this.countdownInterval=setInterval(()=>{this.remainingSeconds>1?(this.remainingSeconds--,this.updateDisplay(this.remainingSeconds,e),this.saveState(this.remainingSeconds)):this.finishCountdown()},1e3),this.manualCheckInterval=setInterval(this.checkManualChanges,500)}updateDisplay(e,t=60){if(this.elements.countdown||this.findElements(),this.elements.countdown&&(this.elements.countdown.textContent=e),this.elements.progressFill){const n=(t-e)/t*100;this.elements.progressFill.style.width=n+"%"}}disableForm(){[this.elements.nomeInput,this.elements.emailInput,this.elements.senhaInput,this.elements.confirmarSenhaInput,this.elements.perfilInput,this.elements.comercioNomeInput,this.elements.comercioCnpjInput,this.elements.cadastroButton].forEach(t=>{t&&(t.disabled=!0,t.addEventListener("focus",this.handleManualEnable),t.addEventListener("input",this.handleManualEnable),t.addEventListener("click",this.handleManualEnable))}),this.elements.cadastroButton&&(this.elements.cadastroButton.textContent="Aguarde..."),this.createOrShowAlert(this.remainingSeconds)}enableForm(){[this.elements.nomeInput,this.elements.emailInput,this.elements.senhaInput,this.elements.confirmarSenhaInput,this.elements.perfilInput,this.elements.comercioNomeInput,this.elements.comercioCnpjInput,this.elements.cadastroButton].forEach(t=>{t&&(t.disabled=!1,t.removeEventListener("focus",this.handleManualEnable),t.removeEventListener("input",this.handleManualEnable),t.removeEventListener("click",this.handleManualEnable))}),this.elements.cadastroButton&&(this.elements.cadastroButton.textContent="Cadastrar"),this.hideAlert(),this.elements.progressFill&&(this.elements.progressFill.style.width="0%"),this.countdownInterval&&clearInterval(this.countdownInterval),this.manualCheckInterval&&clearInterval(this.manualCheckInterval)}finishCountdown(){clearInterval(this.countdownInterval),clearInterval(this.manualCheckInterval),localStorage.removeItem("cadastroRateLimitState"),this.enableForm()}saveState(e){try{localStorage.setItem("cadastroRateLimitState",JSON.stringify({blockedUntil:Date.now()+e*1e3,seconds:e,timestamp:Date.now()}))}catch{}}checkManualChanges(){const e=[this.elements.nomeInput,this.elements.emailInput,this.elements.senhaInput,this.elements.confirmarSenhaInput,this.elements.perfilInput,this.elements.comercioNomeInput,this.elements.comercioCnpjInput,this.elements.cadastroButton];e.some(t=>t&&!t.disabled)&&(this.handleManualEnable(),e.forEach(t=>{t&&(t.disabled=!0)}),this.elements.cadastroButton&&(this.elements.cadastroButton.textContent="Aguarde..."))}handleManualEnable(){const e=Date.now();(!this.lastPunish||e-this.lastPunish>1e3)&&(this.remainingSeconds+=10,this.saveState(this.remainingSeconds),this.updateDisplay(this.remainingSeconds,this.remainingSeconds),this.lastPunish=e)}forceReset(){clearInterval(this.countdownInterval),clearInterval(this.manualCheckInterval),localStorage.removeItem("cadastroRateLimitState"),this.enableForm()}}if(document.getElementById("cadastroForm")){const s=new c;window.cadastroRateLimiter=s,document.addEventListener("keydown",function(e){e.ctrlKey&&e.shiftKey&&e.key==="C"&&s.forceReset()})}class o{constructor(){this.loader=null,this.validation=null,this.init()}init(){document.addEventListener("DOMContentLoaded",()=>{this.setupSystems()})}setupSystems(){this.loader=new d("cadastroForm","loader-cadastro"),this.validation=new m,this.validation.addValidation("NOME","nome"),this.validation.addValidation("EMAIL","email"),this.validation.addValidation("SENHA_HASH","password"),this.validation.addValidation("SENHA_HASH_confirmation","passwordConfirmation"),this.validation.addValidation("PERFIL","perfil"),this.validation.addValidation("COMERCIO_CNPJ","cnpj"),typeof l<"u"&&(this.cnpjFormatter=new l),this.setupPasswordRequirements(),console.log("âœ… Sistema de cadastro inicializado")}setupPasswordRequirements(){const e=document.getElementById("SENHA_HASH"),t=document.getElementById("passwordRequirements");!e||!t||(e.addEventListener("focus",()=>{e.value.length>0?t.classList.add("show"):t.classList.remove("show"),this.validatePasswordRequirements(e.value)}),e.addEventListener("input",()=>{e.value.length>0?t.classList.add("show"):t.classList.remove("show"),this.validatePasswordRequirements(e.value)}),e.addEventListener("blur",()=>{e.value.length===0&&t.classList.remove("show")}),document.addEventListener("focusin",n=>{n.target!==e&&n.target.tagName==="INPUT"&&(this.checkAllRequirements(e.value)||e.value.length===0)&&t.classList.remove("show")}),e.value.length>0?t.classList.add("show"):t.classList.remove("show"),this.validatePasswordRequirements(e.value))}validatePasswordRequirements(e){const t={length:e.length>=12,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/[0-9]/.test(e),special:/[@$!%*?&#]/.test(e)};return Object.keys(t).forEach(n=>{const i=document.querySelector(`[data-requirement="${n}"]`);i&&(i.classList.remove("valid","invalid"),e.length>0&&i.classList.add(t[n]?"valid":"invalid"))}),t}checkAllRequirements(e){const t=this.validatePasswordRequirements(e);return Object.values(t).every(n=>n)}}function r(s,e){const t=document.getElementById(s),n=document.getElementById(e);t&&n&&t.addEventListener("click",()=>{const i=n.type==="password";n.type=i?"text":"password";const a=t.querySelector("i");a&&(a.classList.toggle("bi-eye"),a.classList.toggle("bi-eye-slash"))})}document.getElementById("toggleSenha")&&document.getElementById("SENHA_HASH")&&r("toggleSenha","SENHA_HASH");document.getElementById("toggleSenhaConfirm")&&document.getElementById("SENHA_HASH_confirmation")&&r("toggleSenhaConfirm","SENHA_HASH_confirmation");(document.getElementById("cadastroForm")||document.querySelector(".form-cadastro"))&&(new o,window.RegisterSystem=o);
